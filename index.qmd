---
title: "The Last Giants"
subtitle: "A data-driven safari into the savannah"
author: "Visual Virtuosos"
format: html
editor: visual
---

```{r}

if (!require("pacman")) 
  install.packages("pacman")


pacman::p_load(knitr,tidyverse,lubridate,here,dplyr,ggplot2,ggmap,maps,rnaturalearth,rnaturalearthdata,sf,plotly,caret,glmnet,viridis,rcartocolor,forcats,tidymodels)

```

## Abstract

African elephants face severe threats from poaching and the loss of their natural habitats. Despite global attention towards their conservation, there is considerable uncertainty surrounding the population sizes and trends of elephants across much of Africa. Timely and accurate data on elephant populations is crucial for effective conservation efforts.

A continent-wide survey conducted by the **`National Library of Medicine`** revealed a stark decline in African Savannah Elephants. Africa may have held over 20 million elephants before European colonization and 1 million as recently as the 1970s. The survey estimated a population of 352,271 savannah elephants across study sites in 18 countries, representing approximately 93% of all savannah elephants in those areas. Alarmingly, regions with historical data indicated a significant decline, estimating a decrease of 144,000 elephants between 2007 and 2014. Moreover, current data suggests a continent-wide decline of 8% per year in elephant populations, primarily attributed to poaching. During the 1970s and 1980s, a surge in poaching significantly reduced elephant populations in numerous regions. Moreover, a resurgence of poaching incidents since approximately 2005 has resulted in an alarming annual death toll, estimated at around 30,000 elephants recently.

This project aims to examine how elephant populations across Africa changed between 1995 and 2014. It involves using graphs and maps to show how the number of elephants varied over these years. To understand what might happen in the future, the project will use different mathematical methods to guess how many elephants there might be from 2015 to 2023.

Moreover, this study will also look into whether there's a connection between how many elephants there are and the trade of ivory. By comparing data about how many elephants there are with information about ivory trade, the project will try to find out if ivory trade affects the number of elephants.

The main goals are to see how elephant numbers changed over time, predict how many might exist in the coming years, and understand if the ivory trade has any impact on elephant populations. This research aims to help conservationists better understand and protect these majestic animals.

## Introduction

The African elephant(Loxodonta africana) aka The Gentle Giants, a keystone species crucial to the continent's ecosystem, has faced significant population challenges over the decades due to various factors such as poaching, habitat loss, and human-wildlife conflicts. Understanding the historical trends in elephant populations is fundamental in formulating effective conservation strategies and policies. This project aims to comprehensively analyze the population dynamics of African elephants spanning from 1950 to 2015 by leveraging robust data visualization techniques and advanced statistical methods.

Using datasets sourced from reputable conservation organizations and wildlife databases, the project begins by visually mapping the fluctuations in elephant populations across different regions of Africa over the studied period. Subsequently, employing multiple regression methods, including but not limited to linear regression and time series analysis, the study intends to forecast the elephant population from 2016 to 2023 based on historical data trends.

Moreover, in an effort to comprehend the potential correlation between the illegal ivory trade and elephant populations, the project incorporates ivory trade data alongside elephant population data-set. Through correlation analysis and visual representations, the study aims to discern any discernible patterns or connections between these variables, shedding light on whether the ivory trade has had an impact on the fluctuating populations of African elephants.

By combining data visualization techniques, statistical analyses, and exploration of the complex interplay between elephant populations and the ivory trade, this project endeavors to contribute valuable insights into the dynamics of African elephant conservation and the factors influencing their populations. Ultimately, the findings may aid policymakers, conservationists, and wildlife experts in formulating more targeted and effective measures to safeguard these majestic creatures and their habitats.

## Question 1:- How has elephant population varied over the years across several African countries?

### Introduction

Elephants are the gentle giants and here we want to know about the trends in their population and to find out whether its declining or is at safe level, and if there is a decrease in their population then to find out the reason the cause. Understanding the population dynamics of African elephants is pivotal for conservation efforts and ecological balance. This will help us in safeguarding their future and to show to next many generations the gentle giants of this planet and how marvelous they are.

The dataset under examination spans from 1995 to 2014, presenting a valuable opportunity to predict and comprehend the trends in elephant populations for the subsequent years i.e. 2015 to 2023. This study aims to investigate the variations in elephants population across several African countries during the period, leveraging a multi-faceted analytical approach including data pre-processing, explanatory analysis, predictive modelling and country-level analysis

### Approach

We are going to make a code which serves as a robust approach for visualizing and analyzing the fluctuation in elephant population estimates across multiple years within several African countries. Using libraries such as `ggplot2` and `plotly`, this methodology aggregates and processes elephant population data, offering a comprehensive depiction of population trends. We are going to initially read and preprocess the data-set, grouping data by year and summing up estimates, subsequently training an Ordinary Least Squares (OLS) regression model to predict population estimates for future years. Through visualization, we will make interactive plots, showcasing the historical trends of elephant populations from 1995 to 2015, while also projecting estimates for subsequent years i.e. from 2015 to 2023. The plots illustrate the trajectory of elephant population estimates, distinguishing between actual data and predicted values. By merging actual and forecasted population data, the code encapsulates a holistic view, enabling the viewer to comprehend the variations and potential trajectories of elephant populations across different African countries over time. These visualizations serve as an invaluable tool for understanding the historical trends and potential projections of elephant population changes, facilitating comprehensive insights into the population dynamics across various African regions.

### Analysis

## CODE

```{r}

elephant <- readxl::read_xlsx(here("data","elephant_data.xlsx"))
```

```{r}

total_estimate_per_year <- elephant |>
  group_by(Year) |>
  summarise(Total_Estimate = sum(Estimate))

total_estimate_per_year <- total_estimate_per_year |>
  filter(Year != 2015)

# Checking the derived new data set
glimpse(total_estimate_per_year)

# Fitting a linear regression model
lm_model <- lm(Estimate ~ Year, data = elephant)

# Summary of the model
summary(lm_model)
```

```{r}

# Defining a recipe
ols_recipe <- recipe(Total_Estimate ~ Year, data = total_estimate_per_year) |>
  step_center(Year, all_predictors()) |>
  step_scale(Year, all_predictors())

# Defining the linear regression model
ols_model <- linear_reg() |>
  set_engine("lm")

# Combining recipe and model into a workflow
ols_workflow <- workflow() |>
  add_recipe(ols_recipe) |>
  add_model(ols_model)

# Training the OLS model
ols_fit <- ols_workflow |>
  fit(data = total_estimate_per_year)

# Creating a new data frame for prediction (between years 2015-2023)
new_years <- data.frame(Year = 2015:2023)

# Making predictions using the trained OLS model
ols_predictions <- predict(ols_fit, new_data = new_years)

# Combining the new years and predictions
ols_predictions_data <- data.frame(Year = new_years$Year, Total_Estimate = ols_predictions$.pred)

# Print the OLS predictions
glimpse(ols_predictions_data)
```

```{r}
# Specify the training control
train_control <- trainControl(method = "cv", number = 5)

# Train the OLS model using cross-validation
ols_model <- train(Total_Estimate ~ Year, data = total_estimate_per_year, method = "lm", trControl = train_control)

# Print cross-validated RMSE for each model
print("OLS Model Cross-Validated RMSE:")
print(sqrt(ols_model$results$RMSE))
```

```{r}
#| fig-alt: Visualization of elephant population estimates between 1995-2014

# Plotting the estimated of elephant population between 1995 to 2014
p <- ggplot(total_estimate_per_year, aes(x = Year, y = Total_Estimate, group = 1)) +
  geom_line(aes(color = ifelse(Year <= 2014, "Blue", "Red"))) +
  stat_smooth(method = "loess", se = FALSE) +
  ggtitle("Combined Data: Estimate Over Time") +
  xlab("Year") +
  ylab("Estimate") +
  scale_y_continuous(limits = c(0, 500000), expand = c(0, 0), labels = comma_format(scale = 1e-3)) +
  scale_color_manual(values = c("black", "red3"), guide = FALSE) +
  labs(
    x = "Year",
    y = "Estimate (in Thousands)",
    title = "Trend in Elephant Population from 1995-2015",
    caption = "Source: PeerJ PeerJ Article
doi: 10.7717/peerj.2354 "
  ) +
  theme_minimal()

# Convert ggplot to plotly
population_trend <- ggplotly(p)

# Display the interactive plot
population_trend
```

```{r}
#| fig-alt: Visualization of predicted elephant population estimates between 2015-2023

# Plotting the predicted estimates of elephant population from 2015 to 2023
pred <- ggplot(ols_predictions_data, aes(x = Year, y = Total_Estimate, group = 1)) +
  geom_line(aes(color = ifelse(Year <= 2014, "Blue", "Red"))) +
  stat_smooth(method = "loess", se = FALSE) +
  ggtitle("Combined Data: Estimate Over Time") +
  xlab("Year") +
  ylab("Estimate") +
  scale_y_continuous(limits = c(0, 500000), expand = c(0, 0), labels = comma_format(scale = 1e-3)) +
  scale_color_manual(values = c("black", "red3"), guide = FALSE) +
  labs(
    x = "Year",
    y = "Estimate (in Thousands)",
    title = "Trend in Elephant Population from 1995-2015",
    caption = "Source: PeerJ PeerJ Article
doi: 10.7717/peerj.2354 "
  ) +
  theme_minimal()

# Convert ggplot to plotly
prediction_plot <- ggplotly(pred)

# Display the interactive plot
prediction_plot
```

```{r}
#| fig-alt: Visualization of overall elephant population estimate between 1995-2023

# Combining both the actual and predicted datas using rowbind
combined_data <- rbind(total_estimate_per_year, ols_predictions_data)

# Plotting all the estimates of elephant population between 1995-2023
combined_prediction <- ggplot(combined_data, aes(x = Year, y = Total_Estimate, group = 1)) +
  geom_line(aes(color = ifelse(Year <= 2014, "Blue", "Red"))) +
  stat_smooth(method = "loess", se = FALSE) +
  ggtitle("Combined Data: Estimate Over Time") +
  xlab("Year") +
  ylab("Estimate") +
  scale_y_continuous(limits = c(0, 500000), expand = c(0, 0), labels = comma_format(scale = 1e-3)) +
  scale_color_manual(values = c("black", "red3"), guide = FALSE) +
  labs(
    x = "Year",
    y = "Estimate (in Thousands)",
    title = "Trend in Elephant Population from 1995-2015",
    caption = "Source: PeerJ PeerJ Article
doi: 10.7717/peerj.2354 "
  ) +
  theme_minimal()

# Convert ggplot to plotly
combined_prediction_plot <- ggplotly(combined_prediction)

# Display the interactive plot
combined_prediction_plot
```

## Question 2:- What is the trend of ivory trade in Africa?

### Introduction

The illegal trade of ivory has remained a critical concern, posing significant threats to the African elephant population and biodiversity conservation. This analysis aims to study ivory trade in Africa using available historical data. The dataset covers past ivory trade information and seeks to predict trends from 2020 to 2023. The main goal is to reveal how ivory trade has changed over time by using careful data processing, exploring data, making predictions and creating clear visualizations.

### Approach

We are going to conducts an analysis of ivory trade in Africa based on data from CITES. We read and processe the data-set to count the number of ivory exports per year from 1990 to 2022. It then visualizes this information using a bar plot, showcasing the trend of ivory exports over time. Additionally, it explores the types of ivory exports, displaying their counts through a bar plot. These visualizations enable the observation of trends in ivory trade, showcasing changes in export volumes over the years and providing insights into the types of ivory being traded.

The trend of ivory trade in Africa, as depicted by the analysis, showcases the fluctuation in export counts over the years from 1990 to 2022. It allows for a visual understanding of the general trajectory of ivory exports, indicating whether they have increased, decreased, or remained relatively stable over this period. Additionally, the analysis dives into the types of ivory exports, offering insights into the diversity or dominance of specific types in the trade, which contributes to understanding the overall trend of ivory trade in Africa.

## Plots

```{r}

# Loading ivory data
ivory_exports_data <- read_csv(here("data","cites_ivory_export.csv"))
```

```{r}

# Counting the number of instances for each year
export_count_per_year <- ivory_exports_data |>
  group_by(Year) |>
  summarise(export_count = n())

# Assuming `count_per_year` is your dataset
export_count_per_year <- export_count_per_year |>
  filter(Year > 1994)

glimpse(export_count_per_year)
```

```{r}
#| fig-alt: Visualization of Ivory exports in Africa from 1995 to 2022

# Plotting the Ivory exports between 1990 to 2022
exports_barplot <- ggplot(export_count_per_year, aes(x = as.factor(Year), y = export_count, fill = as.factor(Year), text = paste("Export count: ", export_count))) +
  geom_bar(stat = "identity", color = "black") +
  scale_fill_viridis_d(option = "C") +
  labs(
    x = "Year",
    y = "Number of exports",
    title = "Ivory exports in Africa from 1995 to 2022",
    caption = "Source: CITES (Convention of International Trade in Endangered Species of Wild Fauna and Flora)"
  ) +
  guides(fill = FALSE) +
  theme_minimal() +
  theme(
    axis.text.x = element_text(angle = 45, hjust = 1)
  )

# Convert ggplot to plotly
exports_plotly <- ggplotly(exports_barplot, tooltip = "text")

# Display the interactive plot
exports_plotly
```

## IVORY CARVINGS

```{r warning = FALSE,message=FALSE}
#| fig-alt: Visualizing the Type of Ivory exports in Africa

ivory_term_count <- ivory_exports_data |>
  group_by(Year,Term) |>
  summarise(instance_count = n()) |>
  ungroup()

ivory_term_count <- ivory_term_count |>
  mutate(Term = fct_reorder(Term, instance_count, .desc = TRUE))

carving_ggplot <- ivory_term_count |>
  ggplot(aes( y = fct_rev(Term), size = instance_count, fill = Term)) +
  geom_bar(alpha = 0.7, color = "black") +
  scale_size(range = c(1.4, 10), name = "Population (M)") +
  scale_fill_carto_d(palette = "Safe") +
  theme_minimal() +
  theme(legend.position = "none") +
  labs(
    x = "Count",
    y = "Export Type",
    title = "Type of ivory export",
    caption = "Source: CITES (Convention of International Trade 
    in Endangered Species of Wild Fauna and Flora)"
  )

# converting ggplot to plotly
carvings_plotly <- ggplotly(carving_ggplot, tooltip = "text")

# display the interactive plot
carvings_plotly
```

## Ivory Exports

```{r}

# Assuming `ivory_exports_data` is your dataset
country_export_count <- ivory_exports_data %>%
  filter(Exporter %in% c("ZW", "ZM", "ZA", "BW", "MZ")) %>%
  group_by(Exporter) %>%
  summarise(count = n()) %>%
  mutate(Country = case_when(
    Exporter == "ZW" ~ "Zimbabwe",
    Exporter == "ZM" ~ "Zambia",
    Exporter == "ZA" ~ "South Africa",
    Exporter == "BW" ~ "Botswana",
    Exporter == "MZ" ~ "Mozambique",
    TRUE ~ as.character(Exporter)
  ))

africa <- ne_countries(scale = "medium", continent = "Africa", returnclass = "sf")

export_country_map <- merge(africa, country_export_count, by.x = "name", by.y = "Country")

# Create a ggplot map
gg_export_countries <- ggplot() +
  geom_sf(data = africa, fill = "white") +
  geom_sf(data = export_country_map, aes(fill = count, text = paste("Country: ", country_export_count$Country,"<br>",
                                                                    "Export count: ",count )), color = "#5D2606", size = 0.2) +
  scale_fill_gradient(low = "#F2A64F", high = "#B61210") +
  theme_void() +
  labs(title = "Ivory exports from 1995 to 2022 for biggest Elephant ecosystems")

# Convert ggplot to plotly
gg_export_countries_plotly <- ggplotly(gg_export_countries, tooltip = "text")

# Show the Plotly map
gg_export_countries_plotly
```
