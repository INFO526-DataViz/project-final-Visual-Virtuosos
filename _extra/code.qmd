```{r , warning=FALSE}
#| label: load-pkgs
#| message: false

suppressWarnings(library(tidyverse))

if (!require("pacman")) 
  install.packages("pacman")

pacman::p_load(knitr,tidyverse,lubridate,here,dplyr,here,ggplot2,ggmap,maps,rnaturalearth,rnaturalearthdata,sf,plotly,magick,listviewer,shiny,gganimate,gifski,shiny,shinydashboard,imager)
```

## Dataset Setup

```{r}

elephant <- readxl::read_xlsx(here("data","elephant_data.xlsx"))
```

## Plots

```{r}

# Load the Africa countries dataset
africa <- ne_countries(scale = "medium", continent = "Africa", returnclass = "sf")
View(africa)
```

```{r}

# Load the required libraries
library(sf)
library(ggplot2)
library(rnaturalearth)
library(rnaturalearthdata)
library(gganimate)

# Load the Africa countries dataset
africa <- ne_countries(scale = "medium", continent = "Africa", returnclass = "sf")

# Create a sample dataset with elephant estimates by ISO country code
elephant_data <- data.frame(
  iso_a3 = c("KEN", "TZA", "UGA", "ZAF", "MOZ"),  # ISO country codes
  elephants = c(3000, 5000, 1500, 2000, 4000)  # Estimated elephant populations
)


# Match the elephant data to the countries in the Africa dataset
africa$elephants <- NA  # Create a new column for the elephant estimates
africa$elephants[africa$sovereignt %in% elephant$Country] <- elephant$Estimate

# Create the map
ggplot(africa) +
  geom_sf(aes(fill = elephants)) +
  scale_fill_gradient(low = "lightblue", high = "darkgreen") +
  labs(title = "Elephant Estimates in African Countries") +
  transition_states() +
  theme_minimal()
```

## Data Warangling

```{r}


library(dplyr)
# Select the columns of interest (e.g., country and estimate)

elephant_data <- elephant |>
  select(Country,Ecosystem,Estimate,Year)

elephant_data_1995 <- elephant %>%
  filter(Year == 1995) %>%
  select(Country,Ecosystem, Estimate,Year)

elephant_data_1996 <- elephant %>%
  filter(Year == 1996) %>%
  select(Country,Ecosystem, Estimate,Year)

elephant_data_1998 <- elephant %>%
  filter(Year == 1998) %>%
  select(Country,Ecosystem, Estimate,Year)

elephant_data_1999 <- elephant %>%
  filter(Year == 1999) %>%
  select(Country,Ecosystem, Estimate,Year)

elephant_data_2000 <- elephant %>%
  filter(Year == 2000) %>%
  select(Country,Ecosystem, Estimate,Year)

elephant_data_2001 <- elephant %>%
  filter(Year == 2001) %>%
  select(Country,Ecosystem, Estimate,Year)

elephant_data_2002 <- elephant %>%
  filter(Year == 2002) %>%
  select(Country,Ecosystem, Estimate,Year)

elephant_data_2004 <- elephant %>%
  filter(Year == 2004) %>%
  select(Country,Ecosystem, Estimate,Year)

elephant_data_2005 <- elephant %>%
  filter(Year == 2005) %>%
  select(Country,Ecosystem, Estimate, Year)

elephant_data_2006 <- elephant %>%
  filter(Year == 2006) %>%
  select(Country,Ecosystem, Estimate, Year)

elephant_data_2007 <- elephant %>%
  filter(Year == 2007) %>%
  select(Country,Ecosystem, Estimate, Year)

elephant_data_2008 <- elephant %>%
  filter(Year == 2008) %>%
  select(Country,Ecosystem, Estimate, Year)

elephant_data_2009 <- elephant %>%
  filter(Year == 2009) %>%
  select(Country,Ecosystem, Estimate, Year)

elephant_data_2010 <- elephant %>%
  filter(Year == 2010) %>%
  select(Country,Ecosystem, Estimate, Year)

elephant_data_2014 <- elephant %>%
  filter(Year == 2014) %>%
  select(Country,Ecosystem, Estimate, Year)
```

```{r}

# Load the rnaturalearth library
library(rnaturalearth)

# Get geospatial data for the African continent
africa_data <- ne_countries(scale = "medium", continent = "Africa", returnclass = "sf")


ggplot() +
  geom_sf(data = africa_data, fill = "grey", color = "blue") +  # Africa map
  #geom_point(data = elephant, aes(color = Estimate), size = 3) +  # Elephant data as scatter plot
  scale_color_gradient(low = "lightyellow", high = "darkgreen") +  # Color scale
  labs(title = "Elephant Data in Africa") +
  theme_minimal()
```

```{r}

# Fit a logistic regression model
# Fit a linear regression model
lm_model <- lm(Estimate ~ Year, data = elephant)

# Get summary of the model
summary(lm_model)
```

```{r}

# Create a scatterplot of the data
plot(elephant$Year, elephant$Estimate, main = "Elephant Estimate Over Time", 
     xlab = "Year", ylab = "Estimate", pch = 16, col = "blue")

# Add the regression line to the plot
abline(lm_model, col = "red")

# Create a new data frame with the years of interest
new_data <- data.frame(Year = 2015:2023)

# Make predictions using the linear regression model
predicted_estimates <- predict(lm_model, newdata = new_data)

predicted_data <- data.frame(Year = new_data$Year, Predicted_Estimate = predicted_estimates)

predicted_data
```

```{r}

library(e1071)  # Load the e1071 package for SVM

# Fit an SVM regression model
svm_model <- svm(Estimate ~ Year, data = elephant, kernel = "linear")

predicted_estimates <- predict(svm_model, newdata = new_data)
predicted_data <- data.frame(Year = new_data$Year, Predicted_Estimate = predicted_estimates)

print(predicted_data)
```

## Africa plots

```{r}

# Load the necessary libraries
library(rnaturalearth)
library(ggplot2)

# Load the elephant population data (replace this with your own data)
# Assuming you have a data frame named 'elephant_data' with 'Country', 'Estimate' columns

# Merge the elephant data with natural earth data to get the country shapes
world <- ne_countries(scale = "medium", returnclass = "sf")

# Create a ggplot map
elephant_map_1995 <- merge(world, elephant_data_1995, by.x = "name", by.y = "Country")

# Create a ggplot map
ggplot() +
  geom_sf(data = africa, fill = "white") +
  geom_sf(data = elephant_map_1995, aes(fill = Estimate), color = "brown", size = 0.2) +
  scale_fill_viridis_c(option = "plasma", name = "Estimate") +
  scale_fill_gradient(low = "skyblue", high = "darkgreen") +
  theme_minimal() +
  labs(title = "Elephant Population Estimates in Africa in 1995")
```

## Trying for all with transition state

```{r}


# Load the necessary libraries
library(rnaturalearth)
library(ggplot2)
library(gganimate)

# Load the elephant population data (replace this with your own data)
# Assuming you have a data frame named 'elephant_data' with 'Country', 'Estimate', and 'Year' columns

# Merge the elephant data with natural earth data to get the country shapes
world <- ne_countries(scale = "medium", returnclass = "sf")
elephant_map <- merge(world, elephant_data, by.x = "name", by.y = "Country")

# Create a ggplot map
gg <- ggplot() +
  geom_sf(data = world, fill = "white") +
  geom_sf(data = elephant_map, aes(fill = Estimate), color = "brown", size = 0.2) +
  scale_fill_viridis_c(option = "plasma", name = "Estimate") +
  scale_fill_gradient(low = "skyblue", high = "darkgreen") +
  theme_minimal() +
  labs(title = "Elephant Population Estimates in Africa") +
  transition_states(Year, transition_length = 2, state_length = 1)

# Animate and save the GIF
animated_map <- animate(gg, nframes = 100, duration = 10)
anim_save("elephant_population_animation.gif", animated_map)
```

## Function to create images for every year

```{r}

get_map <- function(y) {
  elephant_data |> filter(Year == y) %>% 
  ggplot() +
  geom_sf(data = africa, fill = "white") +
   geom_sf(data = elephant_map_1995, aes(fill = Estimate, text = paste("Country: ", name)),
          color = "brown", size = 0.2) +
  scale_fill_gradient(low = "skyblue", high = "darkgreen") +
  theme_void() +
  labs(title = "Elephant Population Estimates in Africa in 1995")
    }

y_list <- elephant_data$Year %>% sort %>% unique
my_maps <- paste0("~/temp/m_", seq_along(y_list), ".png")
for (i in seq_along(y_list)){
    get_map(y = y_list[i])
    ggsave(my_maps[i], width = 4, height = 4)
}

# Specify the directory where the images are saved
image_dir <- "~/temp/"

# Create a list of image file names
image_files <- list.files(image_dir, pattern = "*.png", full.names = TRUE)

# Specify the output video file
output_video <- "~/temp/elephant_population_animation.mp4"

# Use ffmpeg to create a video from the images
#system(paste("ffmpeg -r 1 -i", shQuote(image_files), "-c:v libx264 -vf fps=25 -pix_fmt yuv420p", shQuote(output_video)))

# Display a message when the video creation is complete
cat("Video created successfully:", output_video, "\n")

library(magick)

# Specify the path to the video file
output_video <- "~/temp/elephant_population_animation.mp4"

# Display the video using an external application
browseURL(output_video)

image_files
```

## Shiny app

```{r}

# Install and load the required packages
#install.packages(c("shiny", "shinydashboard", "magick"))
library(shiny)
library(shinydashboard)
library(magick)

# Define the UI
ui <- dashboardPage(
  dashboardHeader(title = "Elephant Population Animation"),
  dashboardSidebar(),
  dashboardBody(
    fluidRow(
      box(
        title = "Elephant Population Animation",
        status = "primary",
        solidHeader = TRUE,
        width = 12,
        imageOutput("video")
      )
    )
  )
)

# Define the server logic
server <- function(input, output) {
  # Specify the path to the video file
  output_video <- "~/temp/elephant_population_animation.mp4"
  
  # Display the video
  output$video <- renderImage({
    list(src = output_video, contentType = "video/mp4")
  }, deleteFile = FALSE)
}

# Run the Shiny app
shinyApp(ui, server)

shiny::runApp("path/to/your/app.R")

```

```{r}

# Install and load the required packages
#install.packages(c("shiny", "shinydashboard", "magick", "here"))
library(shiny)
library(shinydashboard)
library(magick)
library(here)

# Define the UI
ui <- dashboardPage(
  dashboardHeader(title = "Elephant Population Animation"),
  dashboardSidebar(),
  dashboardBody(
    fluidRow(
      box(
        title = "Elephant Population Animation",
        status = "primary",
        solidHeader = TRUE,
        width = 12,
        imageOutput("video")
      )
    )
  )
)

# Define the server logic
server <- function(input, output) {
  # Specify the path to the video file using here
  output_video <- here::here("temp/elephant_population_animation.mp4")
  
  # Display the video
  output$video <- renderImage({
    list(src = output_video, contentType = "video/mp4")
  }, deleteFile = FALSE)
}

# Run the Shiny app
#shinyApp(ui, server)

shiny::runApp("path/to/your/app.R")

```

```{r}

# Load the necessary libraries
library(rnaturalearth)
library(ggplot2)
library(plotly)

# Load the elephant population data (replace this with your own data)
# Assuming you have a data frame named 'elephant_data_1995' with 'Country', 'Estimate' columns

# Merge the elephant data with natural earth data to get the country shapes
africa <- ne_countries(scale = "medium", returnclass = "sf", continent = "Africa")
elephant_map_1995 <- merge(africa, elephant_data_1995, by.x = "name", by.y = "Country")

# Create a ggplot map
gg_map_1995 <- ggplot() +
  geom_sf(data = africa, fill = "white") +
   geom_sf(data = elephant_map_1995, aes(fill = Estimate, text = paste("Country: ", name)),
          color = "brown", size = 0.2) +
  scale_fill_gradient(low = "skyblue", high = "darkgreen") +
  theme_void() +
  labs(title = "Elephant Population Estimates in Africa in 1995")

# Convert ggplot to plotly
#elephant_map_1995_plotly <- ggplotly()

# Show the plotly map
#elephant_map_1995_plotly

```

## Plotly map

```{r}

elephant_map_1996 <- merge(world, elephant_data_1996, by.x = "name", by.y = "Country")

# Create a ggplot map
gg_map_1996 <- ggplot() +
  geom_sf(data = africa, fill = "white") +
  geom_sf(data = elephant_map_1996, aes(fill = Estimate), color = "brown", size = 0.2) +
  scale_fill_viridis_c(option = "plasma", name = "Estimate") +
  scale_fill_gradient(low = "skyblue", high = "darkgreen") +
  theme_void() +
  labs(title = "Elephant Population Estimates in Africa in 1996")

# Convert ggplot to plotly
#elephant_map_1996_plotly <- ggplotly()

# Show the plotly map
#elephant_map_1996_plotly

gg_map_1996
```

```{r}

library(rnaturalearth)
library(ggplot2)
library(plotly)

# Assuming elephant_data_1996 and world are already defined

# Merge data
elephant_map_1996 <- merge(world, elephant_data_1996, by.x = "name", by.y = "Country")

# Create a ggplot map
gg_map <- ggplot() +
  geom_sf(data = africa, fill = "white") +
  geom_sf(data = elephant_map_1996, aes(fill = Estimate), color = "brown", size = 0.2) +
  scale_fill_viridis_c(option = "plasma", name = "Estimate") +
  scale_fill_gradient(low = "skyblue", high = "darkgreen") +
  theme_void() +
  labs(title = "Elephant Population Estimates in Africa in 1996")

# Convert ggplot to plotly
#elephant_map_1996_plotly <- ggplotly(gg_map)

# Add theme to the hover
#elephant_map_1996_plotly <- elephant_map_1996_plotly %>% 
  #layout(hoverlabel = list(bgcolor = "white", font = list(family = "Arial", color = "black")))

# Show the plotly map
#elephant_map_1996_plotly

gg_map
```

```{r}

elephant_map_1998 <- merge(world, elephant_data_1998, by.x = "name", by.y = "Country")

# Create a ggplot map
gg_map_1998 <- ggplot() +
  geom_sf(data = africa, fill = "white") +
  geom_sf(data = elephant_map_1998, aes(fill = Estimate), color = "brown", size = 0.2) +
  scale_fill_viridis_c(option = "plasma", name = "Estimate") +
  scale_fill_gradient(low = "skyblue", high = "darkgreen") +
  theme_void() +
  labs(title = "Elephant Population Estimates in Africa in 1998")

gg_map_1998
```

```{r}

elephant_map_1999 <- merge(world, elephant_data_1999, by.x = "name", by.y = "Country")

# Create a ggplot map
gg_map_1999 <- ggplot() +
  geom_sf(data = africa, fill = "white") +
  geom_sf(data = elephant_map_1999, aes(fill = Estimate), color = "brown", size = 0.2) +
  scale_fill_viridis_c(option = "plasma", name = "Estimate") +
  scale_fill_gradient(low = "skyblue", high = "darkgreen") +
  theme_void() +
  labs(title = "Elephant Population Estimates in Africa in 1999")

gg_map_1999
```

```{r}

elephant_map_2000 <- merge(world, elephant_data_2000, by.x = "name", by.y = "Country")

# Create a ggplot map
gg_map_2000 <- ggplot() +
  geom_sf(data = africa, fill = "white") +
  geom_sf(data = elephant_map_2000, aes(fill = Estimate), color = "brown", size = 0.2) +
  scale_fill_viridis_c(option = "plasma", name = "Estimate") +
  scale_fill_gradient(low = "skyblue", high = "darkgreen") +
  theme_void() +
  labs(title = "Elephant Population Estimates in Africa in 2000")

gg_map_2000
```

```{r}

elephant_map_2001 <- merge(world, elephant_data_2001, by.x = "name", by.y = "Country")

# Create a ggplot map
gg_map_2001 <- ggplot() +
  geom_sf(data = africa, fill = "white") +
  geom_sf(data = elephant_map_2001, aes(fill = Estimate), color = "brown", size = 0.2) +
  scale_fill_viridis_c(option = "plasma", name = "Estimate") +
  scale_fill_gradient(low = "skyblue", high = "darkgreen") +
  theme_void() +
  labs(title = "Elephant Population Estimates in Africa in 2001")
```

```{r}

elephant_map_2002 <- merge(world, elephant_data_2002, by.x = "name", by.y = "Country")

# Create a ggplot map
gg_map_2002 <- ggplot() +
  geom_sf(data = africa, fill = "white") +
  geom_sf(data = elephant_map_2002, aes(fill = Estimate), color = "brown", size = 0.2) +
  scale_fill_viridis_c(option = "plasma", name = "Estimate") +
  scale_fill_gradient(low = "skyblue", high = "darkgreen") +
  theme_void() +
  labs(title = "Elephant Population Estimates in Africa in 2002")

gg_map_2002
```

```{r}

elephant_map_2004 <- merge(world, elephant_data_2004, by.x = "name", by.y = "Country")

# Create a ggplot map
gg_map_2004 <- ggplot() +
  geom_sf(data = africa, fill = "white") +
  geom_sf(data = elephant_map_2004, aes(fill = Estimate), color = "brown", size = 0.2) +
  scale_fill_viridis_c(option = "plasma", name = "Estimate") +
  scale_fill_gradient(low = "skyblue", high = "darkgreen") +
  theme_void() +
  labs(title = "Elephant Population Estimates in Africa in 2004")

gg_map_2004
```

```{r}

elephant_map_2005 <- merge(world, elephant_data_2005, by.x = "name", by.y = "Country")

# Create a ggplot map
gg_map_2005 <- ggplot() +
  geom_sf(data = africa, fill = "white") +
  geom_sf(data = elephant_map_2005, aes(fill = Estimate), color = "brown", size = 0.2) +
  scale_fill_viridis_c(option = "plasma", name = "Estimate") +
  scale_fill_gradient(low = "skyblue", high = "darkgreen") +
  theme_void() +
  labs(title = "Elephant Population Estimates in Africa in 2005")

gg_map_2005
```

```{r}

elephant_map_2006 <- merge(world, elephant_data_2006, by.x = "name", by.y = "Country")

# Create a ggplot map
gg_map_2006 <- ggplot() +
  geom_sf(data = africa, fill = "white") +
  geom_sf(data = elephant_map_2006, aes(fill = Estimate), color = "brown", size = 0.2) +
  scale_fill_viridis_c(option = "plasma", name = "Estimate") +
  scale_fill_gradient(low = "skyblue", high = "darkgreen") +
  theme_void() +
  labs(title = "Elephant Population Estimates in Africa in 2006")

gg_map_2006
```

```{r}

elephant_map_2007 <- merge(world, elephant_data_2007, by.x = "name", by.y = "Country")

# Create a ggplot map
gg_map_2007 <- ggplot() +
  geom_sf(data = africa, fill = "white") +
  geom_sf(data = elephant_map_2007, aes(fill = Estimate), color = "brown", size = 0.2) +
  scale_fill_viridis_c(option = "plasma", name = "Estimate") +
  scale_fill_gradient(low = "skyblue", high = "darkgreen") +
  theme_void() +
  labs(title = "Elephant Population Estimates in Africa in 2007")

gg_map_2007
```

```{r}

elephant_map_2008 <- merge(world, elephant_data_2008, by.x = "name", by.y = "Country")

# Create a ggplot map
gg_map_2008 <- ggplot() +
  geom_sf(data = africa, fill = "white") +
  geom_sf(data = elephant_map_2008, aes(fill = Estimate), color = "brown", size = 0.2) +
  scale_fill_viridis_c(option = "plasma", name = "Estimate") +
  scale_fill_gradient(low = "skyblue", high = "darkgreen") +
  theme_void() +
  labs(title = "Elephant Population Estimates in Africa in 2008")

gg_map_2008
```

```{r}

elephant_map_2009 <- merge(world, elephant_data_2009, by.x = "name", by.y = "Country")

# Create a ggplot map
gg_map_2009 <- ggplot() +
  geom_sf(data = africa, fill = "white") +
  geom_sf(data = elephant_map_2009, aes(fill = Estimate), color = "brown", size = 0.2) +
  scale_fill_viridis_c(option = "plasma", name = "Estimate") +
  scale_fill_gradient(low = "skyblue", high = "darkgreen") +
  theme_void() +
  labs(title = "Elephant Population Estimates in Africa in 2009")

gg_map_2009
```

```{r}

elephant_map_2010 <- merge(world, elephant_data_2010, by.x = "name", by.y = "Country")

# Create a ggplot map
gg_map_2010 <- ggplot() +
  geom_sf(data = africa, fill = "white") +
  geom_sf(data = elephant_map_2010, aes(fill = Estimate), color = "brown", size = 0.2) +
  scale_fill_viridis_c(option = "plasma", name = "Estimate") +
  scale_fill_gradient(low = "skyblue", high = "darkgreen") +
  theme_void() +
  labs(title = "Elephant Population Estimates in Africa in 2010")
```

```{r}

elephant_map_2014 <- merge(world, elephant_data_2014, by.x = "name", by.y = "Country")

# Create a ggplot map
gg_map_2014 <- ggplot() +
  geom_sf(data = africa, fill = "white") +
  geom_sf(data = elephant_map_2014, aes(fill = Estimate), color = "brown", size = 0.2) +
  scale_fill_viridis_c(option = "plasma", name = "Estimate") +
  scale_fill_gradient(low = "skyblue", high = "darkgreen") +
  theme_void() +
  labs(title = "Elephant Population Estimates in Africa in 2014")
```

```{r}

library(rnaturalearth)
library(ggplot2)
library(plotly)

generate_elephant_map <- function(data) {
  # Load the natural earth data for Africa
  africa <- ne_countries(scale = "medium", returnclass = "sf", continent = "Africa")
  
  # Merge the elephant data with natural earth data to get the country shapes
  elephant_map <- merge(africa, data, by.x = "name", by.y = "Country")
  
  # Create a ggplot map
  ggplot() +
    geom_sf(data = africa, fill = "white") +
    geom_sf(data = elephant_map, aes(fill = Estimate, text = paste("Country: ", name)),
            color = "brown", size = 0.2) +
    scale_fill_gradient(low = "skyblue", high = "darkgreen") +
    theme_void() +
    labs(title = paste("Elephant Population Estimates in Africa in", year))
  
  # Convert ggplot to plotly
  ggplotly()
}

# Example usage:
# Assuming you have a data frame named 'elephant_data_1995' with 'Country', 'Estimate' columns
# generate_elephant_map(elephant_data_1995, 1995)

```

### Function

```{r}


library(rnaturalearth)
library(ggplot2)
library(plotly)
library(magick)

generate_elephant_map <- function(data,year) {
  # Load the natural earth data for Africa
  africa <- ne_countries(scale = "medium", returnclass = "sf", continent = "Africa")
  
  # Merge the elephant data with natural earth data to get the country shapes
  elephant_map <- merge(africa, data, by.x = "name", by.y = "Country")
  
  # Create a ggplot map
  gg <- ggplot() +
    geom_sf(data = africa, fill = "white") +
    geom_sf(data = elephant_map, aes(fill = Estimate, text = paste("Country: ", name)),
            color = "brown", size = 0.2) +
    scale_fill_gradient(low = "skyblue", high = "darkgreen") +
    theme_void() +
    labs(title = paste("Elephant Population Estimates in Africa in", year))
  
  # Convert ggplot to plotly
  gg_plotly <- ggplotly(gg)
  
  return(gg_plotly)
}


# Specify the years
years <- c(1995, 1996, 2005, 2010, 2014)

# Create a list to store the plotly objects
plotly_list <- list()

# Generate plots for each year
for (year in years) {
  plotly_list[[as.character(year)]] <- generate_elephant_map(get(paste0("elephant_data_", year)), year)
}
```

```{r}

library(rnaturalearth)
library(ggplot2)
library(plotly)

generate_elephant_map <- function(elephant_data, year) {
  # Load the natural earth data for Africa
  africa <- ne_countries(scale = "medium", returnclass = "sf", continent = "Africa")
  
  # Merge the elephant data with natural earth data to get the country shapes
  elephant_map <- merge(africa, elephant_data, by.x = "name", by.y = "Country")
  
  # Create a ggplot map
  gg <- ggplot() +
    geom_sf(data = africa, fill = "white") +
    geom_sf(data = elephant_map, aes(fill = Estimate), color = "brown", size = 0.2) +
    scale_fill_viridis_c(option = "plasma", name = "Estimate") +
    scale_fill_gradient(low = "skyblue", high = "darkgreen") +
    theme_void() +
    labs(title = paste("Elephant Population Estimates in Africa in", year))
  
  # Convert ggplot to plotly
  gg_plotly <- ggplotly(gg)
  
  return(gg_plotly)
}


# Call the function with the data for 1996
#elephant_1995_plot <- generate_elephant_map(elephant_data_1995, 1995)
elephant_1996_plot <- generate_elephant_map(elephant_data_1996, 1996)
elephant_2005_plot <- generate_elephant_map(elephant_data_2005, 2005)
elephant_2006_plot <- generate_elephant_map(elephant_data_2006, 2006)
elephant_2010_plot <- generate_elephant_map(elephant_data_2010, 2010)
elephant_2014_plot <- generate_elephant_map(elephant_data_2014, 2014)

elephant_data_2010

elephant_2014_plot
```

## All Elephant plots

```{r}

gg_map_1995
gg_map_1996
elephant_2010_plot
elephant_2014_plot
```

```{r}

elephant_2005_plot
```

```{r}

elephant_2006_plot
```

```{r}

elephant_2010_plot
```

```{r}

elephant_2014_plot
```

```{r}

library(gganimate)

# Combine your ggplot objects into a list
plots <- list(
  gg_map_1995,
  gg_map_1996,
  gg_map_1998,
  gg_map_1999,
  gg_map_2000,
  gg_map_2001,
  gg_map_2002,
  gg_map_2005,
  gg_map_2006,
  gg_map_2007,
  gg_map_2008,
  gg_map_2009,
  gg_map_2010,
  gg_map_2014
)
```

```{r}

# Install and load the required packages
#install.packages(c("shiny", "shinydashboard", "plotly", "ggplot2"))
library(shiny)
library(shinydashboard)
library(plotly)
library(ggplot2)

# Assuming you have a list of Plotly plots
plots <- list(
  elephant_1996_plot,
  elephant_2005_plot,
  elephant_2006_plot,
  elephant_2010_plot,
  elephant_2014_plot
)



```

```{r}

library(animation)
## make sure ImageMagick has been installed in your system

# Assuming you have a list of Plotly plots


# Additional libraries
library(animation)

# Make sure ImageMagick has been installed on your system

# Save GIF animation
saveGIF({
  for (i in seq_along(plots)) {
    print(plots[[i]])
    Sys.sleep(1)  # Add a sleep to control the speed of the animation
  }
}, interval = 1, movie.name = "elephant_animation.gif", ani.width = 800, ani.height = 400, fps = 10)


```

```{r}

knitr::include_graphics("elephant_animation.gif")
```

```{r}

# app.R

library(shiny)
library(shinydashboard)

# Define UI
ui <- dashboardPage(
  dashboardHeader(title = "Elephant Animation"),
  dashboardSidebar(),
  dashboardBody(
    box(
      title = "Elephant Animation",
      status = "primary",
      solidHeader = TRUE,
      width = 12,
      img(src = "elephant_animation.gif", width = "100%", height = "100%")
    )
  )
)

# Define server
server <- function(input, output, session) {
}

# Run the Shiny app
shinyApp(ui, server)

```

### Predictions

```{r Loadiing_req_packs, }
install.packages("glmnet")
install.packages("polycor")


library(glmnet)
library(polycor)
library(caret)
```

```{r}
data_for_pred <- readxl::read_xlsx(here("data","elephant_data.xlsx"))
View(data_for_pred)
data_for_pred <- data_for_pred |>
  select(Country, Year, Estimate, SE)

data_for_pred$Country <- as.factor(data_for_pred$Country)
levels(data_for_pred$Country) <- levels(train_data$Country)

predictors <- subset(data_for_pred, select = c("Year", "Country"))
target_var <- data_for_pred$Estimate
```

```{r}
# manually splitting dataset

set.seed(123)
train_countries <- data_for_pred |>
  group_by(Country) |>
  sample_frac(0.7) |>
  ungroup()

test_countries <- anti_join(data_for_pred, train_countries, by = "Country")

View(test_countries)
#train_ecosystems <- data_for_pred |>
 # group_by(Ecosystem) |>
  #sample_frac(0.7) |>
  #ungroup()

#test_ecosystems <- anti_join(data_for_pred, train_ecosystems, by = "Ecosystem")

#train_stratum <- data_for_pred |>
#  group_by(Stratum) |>
# sample_frac(0.7) |>
# ungroup()

#test_stratum <- anti_join(data_for_pred, train_stratum, by = "Stratum")

train_year <- data_for_pred |>
  group_by(Year) |>
  sample_frac(0.7) |>
  ungroup()

test_year <- anti_join(data_for_pred, train_year, by = "Year")

#train_source <- data_for_pred |>
#  group_by(Source) |>
# sample_frac(0.7) |>
# ungroup()

#test_source <- anti_join(data_for_pred, train_source, by = "Source")

trainIndex <- createDataPartition(target_var, p = 1, list = FALSE)


train_data <- bind_rows(train_countries, train_year)
train_data <- train_data[trainIndex, ]
View(train_data)

test_data <- bind_rows(test_countries, test_year)

test_data <- anti_join(data_for_pred, train_data)
View(test_data)

```

```{r ols_reg}
ols_model <- lm(Estimate ~ ., data = train_data)

ols_pred <- predict(ols_model, newdata = test_data)


```

```{r poly_reg}

poly_degree <- 2

poly_model <- lm(Estimate ~ poly(Year, poly_degree) + Country, data = train_data)

poly_predictions <- predict(poly_model, newdata = test_data)


```

```{r}
lasso_model <- cv.glmnet(
  x = as.matrix(train_data[, !colnames(train_data) %in% "Estimate"]),  # Predictor matrix without the "Estimate" column
  y = train_data$Estimate,  # Target variable (assuming "Estimate" is the column you're predicting)
  alpha = 1  # Alpha parameter for Lasso regression (1 for Lasso, 0 for Ridge)
)


lasso_predictions <- predict(lasso_model, s = "lambda.min", newx = as.matrix(test_data[, -c("Target_Variable")]))
```

```{r}
elastic_model <- cv.glmnet(as.matrix(train_data[, -c("Estimate")]), train_data$Estimate, alpha = 0.5)

elastic_predictions <- predict(elastic_model, s = "lambda.min", newx = as.matrix(test_data[, -c("Target_Variable")]))
```
